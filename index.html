<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dual Environmental Weather Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 25%, #6ee7b7 50%, #34d399 75%, #10b981 100%);
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      color: #065f46;
    }

    .header h1 {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .dashboards-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }

    .dashboard {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .dashboard-title {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 600;
      color: #065f46;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(16, 185, 129, 0.3);
    }

    .location {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 0.9rem;
      color: #047857;
      margin-bottom: 15px;
    }

    .last-updated {
      font-size: 0.8rem;
      color: #059669;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-bottom: 20px;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }

    .card {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.5);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .icon-container {
      width: 45px;
      height: 45px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
    }

    .temperature .icon-container {
      background: linear-gradient(135deg, #fca5a5, #ef4444);
      color: white;
    }

    .humidity .icon-container {
      background: linear-gradient(135deg, #93c5fd, #3b82f6);
      color: white;
    }

    .soil-moisture .icon-container {
      background: linear-gradient(135deg, #86efac, #10b981);
      color: white;
    }

    .precipitation .icon-container {
      background: linear-gradient(135deg, #c4b5fd, #8b5cf6);
      color: white;
    }

    .card-content {
      text-align: right;
    }

    .card-label {
      font-size: 0.8rem;
      color: #047857;
      font-weight: 500;
      margin-bottom: 6px;
    }

    .card-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: #065f46;
      margin-bottom: 2px;
    }

    .card-unit {
      font-size: 0.7rem;
      color: #059669;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: #e5e7eb;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 12px;
    }

    .progress-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.8s ease;
    }

    .temperature .progress-fill {
      background: linear-gradient(90deg, #60a5fa, #ef4444);
    }

    .humidity .progress-fill {
      background: linear-gradient(90deg, #93c5fd, #2563eb);
    }

    .soil-moisture .progress-fill {
      background: linear-gradient(90deg, #86efac, #059669);
    }

    .precipitation .progress-fill {
      background: linear-gradient(90deg, #c4b5fd, #7c3aed);
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 200px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #d1fae5;
      border-top: 4px solid #10b981;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .error {
      background: rgba(254, 226, 226, 0.9);
      border: 1px solid #fca5a5;
      color: #991b1b;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      margin: 15px 0;
    }

    .retry-btn {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
      font-size: 0.9rem;
    }

    .retry-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
    }

    .chart-container {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .chart-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #065f46;
      margin-bottom: 15px;
      text-align: center;
    }

    .hour-bars {
      display: flex;
      align-items: end;
      gap: 2px;
      height: 80px;
      margin-bottom: 10px;
    }

    .hour-bar {
      flex: 1;
      background: linear-gradient(to top, #10b981, #6ee7b7);
      border-radius: 2px 2px 0 0;
      min-height: 3px;
      transition: all 0.3s ease;
      position: relative;
    }

    .hour-bar:hover {
      background: linear-gradient(to top, #059669, #34d399);
      transform: scaleY(1.1);
    }

    .hour-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: #047857;
    }

    .arduino-config {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .config-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #065f46;
      margin-bottom: 15px;
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-group label {
      display: block;
      font-size: 0.9rem;
      color: #047857;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .input-group input {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid #d1fae5;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: border-color 0.3s ease;
    }

    .input-group input:focus {
      outline: none;
      border-color: #10b981;
    }

    .connect-btn {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    .connect-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
    }

    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-connected {
      background: #10b981;
    }

    .status-disconnected {
      background: #ef4444;
    }

    .status-connecting {
      background: #f59e0b;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    @media (max-width: 1200px) {
      .dashboards-container {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 2rem;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .card {
        padding: 15px;
      }

      .card-value {
        font-size: 1.5rem;
      }

      .dashboards-container {
        gap: 15px;
      }

      .dashboard {
        padding: 20px;
      }
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üåø Dual Environmental Dashboard</h1>
    </div>

    <!-- Dashboards Container -->
    <div class="dashboards-container">
      <!-- Open-Meteo Dashboard -->
      <div class="dashboard">
        <div class="dashboard-title">üåç Open-Meteo Weather Station</div>
        <div class="location">
          <span>üìç</span>
          <span>Lagos, Nigeria (8.4966¬∞N, 4.5421¬∞E)</span>
        </div>
        <div class="last-updated" id="openMeteoLastUpdated">
          <span>üïí</span>
          <span>Loading...</span>
        </div>

        <!-- Loading State -->
        <div class="loading" id="openMeteoLoading">
          <div class="spinner"></div>
          <h3 style="color: #065f46; font-weight: 600;">Loading weather data...</h3>
        </div>

        <!-- Error State -->
        <div class="error hidden" id="openMeteoError">
          <h4>‚ùå Error Loading Data</h4>
          <p id="openMeteoErrorMessage"></p>
          <button class="retry-btn" onclick="fetchOpenMeteoData()">üîÑ Try Again</button>
        </div>

        <!-- Dashboard Content -->
        <div id="openMeteoContent" class="hidden">
          <!-- Current Conditions Grid -->
          <div class="dashboard-grid">
            <!-- Temperature Card -->
            <div class="card temperature">
              <div class="card-header">
                <div class="icon-container">üå°Ô∏è</div>
                <div class="card-content">
                  <div class="card-label">Temperature</div>
                  <div class="card-value" id="openMeteoTemperature">--</div>
                  <div class="card-unit">¬∞C</div>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="openMeteoTemperatureProgress"></div>
              </div>
            </div>

            <!-- Humidity Card -->
            <div class="card humidity">
              <div class="card-header">
                <div class="icon-container">üíß</div>
                <div class="card-content">
                  <div class="card-label">Humidity</div>
                  <div class="card-value" id="openMeteoHumidity">--</div>
                  <div class="card-unit">%</div>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="openMeteoHumidityProgress"></div>
              </div>
            </div>

            <!-- Soil Moisture Card -->
            <div class="card soil-moisture">
              <div class="card-header">
                <div class="icon-container">üå±</div>
                <div class="card-content">
                  <div class="card-label">Soil Moisture</div>
                  <div class="card-value" id="openMeteoSoilMoisture">--</div>
                  <div class="card-unit">m¬≥/m¬≥</div>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="openMeteoSoilMoistureProgress"></div>
              </div>
            </div>

            <!-- Precipitation Card -->
            <div class="card precipitation">
              <div class="card-header">
                <div class="icon-container">‚òî</div>
                <div class="card-content">
                  <div class="card-label">Precipitation</div>
                  <div class="card-value" id="openMeteoPrecipitation">--</div>
                  <div class="card-unit">%</div>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="openMeteoPrecipitationProgress"></div>
              </div>
            </div>
          </div>

          <!-- 24-Hour Precipitation Chart -->
          <div class="chart-container">
            <div class="chart-title">24-Hour Precipitation Forecast</div>
            <div class="hour-bars" id="openMeteoPrecipitationChart"></div>
            <div class="hour-labels" id="openMeteoHourLabels"></div>
          </div>
        </div>
      </div>

      <!-- Arduino Dashboard -->
      <div class="dashboard">
        <div class="dashboard-title">üîß Arduino Weather Station</div>

        <!-- Arduino Configuration -->
        <div class="arduino-config">
          <div class="config-title">
            <span class="status-indicator" id="arduinoStatus"></span>
            Arduino API Configuration
          </div>
          <div class="input-group">
            <label for="arduinoUrl">API Endpoint URL:</label>
            <input type="text" id="arduinoUrl" placeholder="https://instantirrigation.vercel.app/api/sensors"
              value="https://instantirrigation.vercel.app/api/sensors">
          </div>
          <button class="connect-btn" onclick="connectArduino()">Connect to Arduino</button>
        </div>

        <div class="location">
          <span>üîß</span>
          <span>Smart Irrigation System</span>
        </div>
        <div class="last-updated" id="arduinoLastUpdated">
          <span>üïí</span>
          <span>Not connected</span>
        </div>

        <!-- Loading State -->
        <div class="loading hidden" id="arduinoLoading">
          <div class="spinner"></div>
          <h3 style="color: #065f46; font-weight: 600;">Connecting to Arduino...</h3>
        </div>

        <!-- Error State -->
        <div class="error hidden" id="arduinoError">
          <h4>‚ùå Error Connecting to Arduino</h4>
          <p id="arduinoErrorMessage"></p>
          <button class="retry-btn" onclick="fetchArduinoData()">üîÑ Try Again</button>
        </div>

        <!-- Dashboard Content -->
        <div id="arduinoContent" class="hidden">
          <!-- Current Conditions Grid -->
          <div class="dashboard-grid">
            <!-- Temperature Card -->
            <div class="card temperature">
              <div class="card-header">
                <div class="icon-container">üå°Ô∏è</div>
                <div class="card-content">
                  <div class="card-label">Temperature</div>
                  <div class="card-value" id="arduinoTemperature">--</div>
                  <div class="card-unit">¬∞C</div>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="arduinoTemperatureProgress"></div>
              </div>
            </div>

            <!-- Humidity Card -->
            <div class="card humidity">
              <div class="card-header">
                <div class="icon-container">üíß</div>
                <div class="card-content">
                  <div class="card-label">Humidity</div>
                  <div class="card-value" id="arduinoHumidity">--</div>
                  <div class="card-unit">%</div>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="arduinoHumidityProgress"></div>
              </div>
            </div>

            <!-- Soil Moisture Card -->
            <div class="card soil-moisture">
              <div class="card-header">
                <div class="icon-container">üå±</div>
                <div class="card-content">
                  <div class="card-label">Soil Moisture</div>
                  <div class="card-value" id="arduinoSoilMoisture">--</div>
                  <div class="card-unit">% (Irrigation)</div>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="arduinoSoilMoistureProgress"></div>
              </div>
            </div>

            <!-- Precipitation Card -->
            <div class="card precipitation" style="opacity: 0.6;">
              <div class="card-header">
                <div class="icon-container">üö∞</div>
                <div class="card-content">
                  <div class="card-label">Pump Status</div>
                  <div class="card-value" id="arduinoPumpStatus">OFF</div>
                  <div class="card-unit">System</div>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="arduinoPumpProgress"></div>
              </div>
            </div>
          </div>

          <!-- Arduino Data Chart -->
          <div class="chart-container">
            <div class="chart-title">Moisture Levels (Last 24 Readings)</div>
            <div class="hour-bars" id="arduinoDataChart"></div>
            <div class="hour-labels" id="arduinoDataLabels"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let openMeteoData = null;
    let arduinoData = null;
    let arduinoInterval = null;

    // Open-Meteo API Functions
    async function fetchOpenMeteoData() {
      const loadingState = document.getElementById('openMeteoLoading');
      const errorState = document.getElementById('openMeteoError');
      const dashboardContent = document.getElementById('openMeteoContent');

      // Show loading state
      loadingState.classList.remove('hidden');
      errorState.classList.add('hidden');
      dashboardContent.classList.add('hidden');

      try {
        const response = await fetch(
          'https://api.open-meteo.com/v1/forecast?latitude=8.4966&longitude=4.5421&hourly=soil_moisture_3_to_9cm,precipitation_probability&current=temperature_2m,relative_humidity_2m'
        );

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        openMeteoData = await response.json();
        updateOpenMeteoDashboard();
        updateOpenMeteoLastUpdated();

        // Hide loading and show dashboard
        loadingState.classList.add('hidden');
        dashboardContent.classList.remove('hidden');

      } catch (error) {
        console.error('Error fetching Open-Meteo data:', error);

        // Show error state
        loadingState.classList.add('hidden');
        document.getElementById('openMeteoErrorMessage').textContent = error.message;
        errorState.classList.remove('hidden');
      }
    }

    function updateOpenMeteoDashboard() {
      if (!openMeteoData) return;

      // Update current conditions
      const temperature = openMeteoData.current.temperature_2m;
      const humidity = openMeteoData.current.relative_humidity_2m;
      const soilMoisture = openMeteoData.hourly.soil_moisture_3_to_9cm[0];
      const precipitation = openMeteoData.hourly.precipitation_probability[0];

      // Update temperature
      document.getElementById('openMeteoTemperature').textContent = temperature.toFixed(1);
      document.getElementById('openMeteoTemperatureProgress').style.width = `${Math.min(temperature * 2, 100)}%`;

      // Update humidity
      document.getElementById('openMeteoHumidity').textContent = humidity;
      document.getElementById('openMeteoHumidityProgress').style.width = `${humidity}%`;

      // Update soil moisture
      document.getElementById('openMeteoSoilMoisture').textContent = soilMoisture.toFixed(3);
      document.getElementById('openMeteoSoilMoistureProgress').style.width = `${Math.min(soilMoisture * 1000, 100)}%`;

      // Update precipitation
      document.getElementById('openMeteoPrecipitation').textContent = precipitation;
      document.getElementById('openMeteoPrecipitationProgress').style.width = `${precipitation}%`;

      // Update 24-hour precipitation chart
      updateOpenMeteoPrecipitationChart();
    }

    function updateOpenMeteoPrecipitationChart() {
      if (!openMeteoData) return;

      const chartContainer = document.getElementById('openMeteoPrecipitationChart');
      const labelsContainer = document.getElementById('openMeteoHourLabels');

      // Clear existing chart
      chartContainer.innerHTML = '';
      labelsContainer.innerHTML = '';

      // Get 24 hours of data
      const precipitationData = openMeteoData.hourly.precipitation_probability.slice(0, 24);
      const timeData = openMeteoData.hourly.time.slice(0, 24);

      // Create bars
      precipitationData.forEach((value, index) => {
        const bar = document.createElement('div');
        bar.className = 'hour-bar';
        bar.style.height = `${Math.max(value, 4)}%`;
        bar.title = `${value}% at ${new Date(timeData[index]).getHours()}:00`;
        chartContainer.appendChild(bar);
      });

      // Create labels (show every 4th hour)
      timeData.forEach((time, index) => {
        if (index % 4 === 0) {
          const label = document.createElement('span');
          label.textContent = `${new Date(time).getHours()}:00`;
          labelsContainer.appendChild(label);
        } else {
          const spacer = document.createElement('span');
          labelsContainer.appendChild(spacer);
        }
      });
    }

    function updateOpenMeteoLastUpdated() {
      const now = new Date();
      const timeString = now.toLocaleTimeString();
      document.getElementById('openMeteoLastUpdated').innerHTML = `
                <span>üïí</span>
                <span>Last updated: ${timeString}</span>
            `;
    }

    // Arduino API Functions
    async function connectArduino() {
      const url = document.getElementById('arduinoUrl').value;
      if (!url) {
        alert('Please enter an Arduino API URL');
        return;
      }

      // Update status to connecting
      const statusIndicator = document.getElementById('arduinoStatus');
      statusIndicator.className = 'status-indicator status-connecting';

      // Clear any existing interval
      if (arduinoInterval) {
        clearInterval(arduinoInterval);
      }

      // Try to fetch data
      await fetchArduinoData();

      // If successful, start polling every 30 seconds
      if (arduinoData) {
        arduinoInterval = setInterval(fetchArduinoData, 30000);
      }
    }

    async function fetchArduinoData() {
      const url = document.getElementById('arduinoUrl').value;
      const loadingState = document.getElementById('arduinoLoading');
      const errorState = document.getElementById('arduinoError');
      const dashboardContent = document.getElementById('arduinoContent');
      const statusIndicator = document.getElementById('arduinoStatus');

      // Show loading state
      loadingState.classList.remove('hidden');
      errorState.classList.add('hidden');
      dashboardContent.classList.add('hidden');

      try {
        const response = await fetch(url);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        arduinoData = await response.json();
        updateArduinoDashboard();
        updateArduinoLastUpdated();

        // Update status to connected
        statusIndicator.className = 'status-indicator status-connected';

        // Hide loading and show dashboard
        loadingState.classList.add('hidden');
        dashboardContent.classList.remove('hidden');

      } catch (error) {
        console.error('Error fetching Arduino data:', error);

        // Update status to disconnected
        statusIndicator.className = 'status-indicator status-disconnected';

        // Show error state
        loadingState.classList.add('hidden');
        document.getElementById('arduinoErrorMessage').textContent = error.message;
        errorState.classList.remove('hidden');
      }
    }

    function updateArduinoDashboard() {
      if (!arduinoData) return;

      // Arduino irrigation system data format:
      // {
      //   temperature: 25.5,    // from DHT11
      //   humidity: 60,         // from DHT11  
      //   moisture: 45,         // soil moisture sensor
      //   pumpActive: false,    // pump status
      //   timestamp: "2024-01-01T12:00:00Z"
      // }

      const temperature = arduinoData.temperature || 0;
      const humidity = arduinoData.humidity || 0;
      const moisture = arduinoData.moisture || 0;
      const pumpActive = arduinoData.pumpActive || false;

      // Update temperature
      document.getElementById('arduinoTemperature').textContent = temperature.toFixed(1);
      document.getElementById('arduinoTemperatureProgress').style.width = `${Math.min(temperature * 2, 100)}%`;

      // Update humidity
      document.getElementById('arduinoHumidity').textContent = humidity;
      document.getElementById('arduinoHumidityProgress').style.width = `${humidity}%`;

      // Update soil moisture
      document.getElementById('arduinoSoilMoisture').textContent = moisture;
      document.getElementById('arduinoSoilMoistureProgress').style.width = `${moisture}%`;

      // Update pump status
      const pumpStatusElement = document.getElementById('arduinoPumpStatus');
      const pumpProgressElement = document.getElementById('arduinoPumpProgress');

      if (pumpActive) {
        pumpStatusElement.textContent = 'ON';
        pumpStatusElement.style.color = '#10b981';
        pumpProgressElement.style.width = '100%';
        pumpProgressElement.style.background = 'linear-gradient(90deg, #34d399, #10b981)';
      } else {
        pumpStatusElement.textContent = 'OFF';
        pumpStatusElement.style.color = '#6b7280';
        pumpProgressElement.style.width = '0%';
      }

      // Update chart with recent readings (if available)
      updateArduinoChart();
    }

    function updateArduinoChart() {
      const chartContainer = document.getElementById('arduinoDataChart');
      const labelsContainer = document.getElementById('arduinoDataLabels');

      // Clear existing chart
      chartContainer.innerHTML = '';
      labelsContainer.innerHTML = '';

      // Use moisture readings for irrigation monitoring
      const moistureReadings = arduinoData.moistureHistory || [arduinoData.moisture || 0];
      const maxReading = Math.max(...moistureReadings, 100); // Max 100% moisture

      // Create bars for recent readings
      moistureReadings.slice(-24).forEach((value, index) => {
        const bar = document.createElement('div');
        bar.className = 'hour-bar';
        bar.style.height = `${(value / maxReading) * 100}%`;
        bar.title = `Moisture: ${value}%`;

        // Color code based on moisture level
        if (value < 30) {
          bar.style.background = 'linear-gradient(to top, #ef4444, #fca5a5)'; // Red for dry
        } else if (value < 60) {
          bar.style.background = 'linear-gradient(to top, #f59e0b, #fbbf24)'; // Yellow for moderate
        } else {
          bar.style.background = 'linear-gradient(to top, #10b981, #6ee7b7)'; // Green for moist
        }

        chartContainer.appendChild(bar);
      });

      // Create simple labels
      for (let i = 0; i < Math.min(moistureReadings.length, 24); i++) {
        const label = document.createElement('span');
        label.textContent = i % 6 === 0 ? `${i + 1}` : '';
        labelsContainer.appendChild(label);
      }
    }

    function updateArduinoLastUpdated() {
      const now = new Date();
      const timeString = now.toLocaleTimeString();
      document.getElementById('arduinoLastUpdated').innerHTML = `
                <span>üïí</span>
                <span>Last updated: ${timeString}</span>
            `;
    }

    // Initialize dashboards
    fetchOpenMeteoData();

    // Refresh Open-Meteo data every 10 minutes
    setInterval(fetchOpenMeteoData, 10 * 60 * 1000);

    // Initialize Arduino status
    document.getElementById('arduinoStatus').className = 'status-indicator status-disconnected';
  </script>
</body>

</html>